"use strict";(self["webpackChunkwisdom_park_visitor"]=self["webpackChunkwisdom_park_visitor"]||[]).push([[755],{1755:function(t,e,i){i.r(e),i.d(e,{default:function(){return _}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"visitor-log"},[i("van-sticky",{attrs:{"offset-top":1e-8}},[i("van-nav-bar",{attrs:{title:"访客记录","left-arrow":""},on:{"click-left":t.onClickLeft}})],1),i("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.refreshing,callback:function(e){t.refreshing=e},expression:"refreshing"}},[0==this.data.length?i("van-empty",{staticStyle:{height:"80vh"},attrs:{description:"当前无访客"}}):i("van-list",{staticStyle:{"min-height":"calc(100vh - 46px)"},attrs:{finished:t.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.data,(function(e,s){return i("div",{key:s,staticClass:"custom-list",on:{click:function(i){return t.handleQuery(e)}}},[i("van-swipe-cell",{scopedSlots:t._u([{key:"right",fn:function(){return[i("van-button",{attrs:{square:"",type:"danger",text:"删除"},on:{click:function(i){return t.handleDel(e,s)}}})]},proxy:!0}],null,!0)},[i("van-cell",{attrs:{size:"large"},scopedSlots:t._u([{key:"title",fn:function(){return[i("div",{staticClass:"title"},[i("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:1==e.visitType?"VIPfangke":"linshifangke"}}),i("span",[t._v(t._s({1:"贵宾访客",3:"临时访客"}[e.visitType]))])],1)]},proxy:!0},{key:"label",fn:function(){return[i("div",{staticClass:"custom-title-detail"},[i("div",[i("span",[t._v("访客姓名：")]),i("span",{staticClass:"van-ellipsis"},[t._v(" "+t._s(e.visitorName))])]),i("div",[i("span",[t._v("访问时间：")]),i("span",[t._v(t._s(e.visitStartTime)+" - "+t._s(e.visitEndTime))])])])]},proxy:!0},{key:"default",fn:function(){return[i("span",{class:e.sts},[i("i"),t._v(" "+t._s(t.visitorStsList[e.sts])+" ")])]},proxy:!0}],null,!0)})],1)],1)})),0)],1)],1)},a=[],n=i(2513),r=n.Z,o=i(1001),l=(0,o.Z)(r,s,a,!1,null,null,null),_=l.exports},2513:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var vuex__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(629),_api_visitor__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3581);__webpack_exports__["Z"]={name:"VisitorLog",data(){return{data:[],loading:!1,finished:!1,refreshing:!1,page:{page:1,size:8},visitorStsList:{YYZ:"预约中",YYTY:"预约同意",YYBTY:"未同意",YDF:"已到访",YLK:"已离开",JJTX:"拒绝通行"}}},methods:{onClickLeft(){this.$router.back(-1)},handleQuery(t){const e=!["YYZ","YYTY"].includes(t.sts);switch("YYZ"!==t.sts&&this.$toast({duration:3e3,message:"该访客预约单状态并非【预约中】，不可进行操作"}),t.visitType){case"1":this.$router.push({name:"VIPappointment",params:{disabled:e,vipVisitId:t.visitorInfoId}});break;case"3":this.$router.push({name:"temporaryVisitorReg",params:{disabled:e,isToOpenId:!0,temporaryVisitId:t.visitorInfoId}});break;default:this.$toast({message:"数据失效"});break}},handleDel(t,e){this.$dialog.confirm({title:"请确认是否删除此条信息？"}).then((()=>{(0,_api_visitor__WEBPACK_IMPORTED_MODULE_0__.XV)({visitorInfoId:t.visitorInfoId,createName:this.myUserInfo.name}).then((t=>{200===t.code?(this.$toast({message:t.msg}),this.data.splice(e,1)):this.$toast({message:t.msg})}))})).catch((()=>{}))},onLoad(){(0,_api_visitor__WEBPACK_IMPORTED_MODULE_0__.Hq)({phoneNbr:this.myUserInfo.phoneNbr,pageNo:this.page.page,pageSize:this.page.size}).then((res=>{this.loading=!1,200===res.code?(this.page.page+=1,this.refreshing&&(this.data=[],this.refreshing=!1),this.data=this.data.concat(res.data.row.map((item=>({...item,visitStartTime:this.$util.format(new Date(item.visitStartTime.replace(/-/g,"/")),"yyyy-MM-dd hh:mm"),visitEndTime:this.$util.format(new Date(item.visitEndTime.replace(/-/g,"/")),"yyyy-MM-dd hh:mm"),visitorName:String(eval("("+item.visitorPersonArr+")").map((t=>t.visitorName)))})))),this.data.length===res.data.total&&(this.finished=!0)):this.$toast.fail({message:res.msg})})).catch((()=>{this.loading=!1}))},onRefresh(){this.finished=!1,this.loading=!0,this.page.page=1,this.onLoad()}},async created(){this.onRefresh()},computed:(0,vuex__WEBPACK_IMPORTED_MODULE_1__.rn)({myUserInfo:t=>t.user.userInfo})}}}]);
//# sourceMappingURL=755.b1818436.js.map