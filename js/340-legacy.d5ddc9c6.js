"use strict";(self["webpackChunkwisdom_park_visitor"]=self["webpackChunkwisdom_park_visitor"]||[]).push([[340],{9340:function(e,r,i){i.r(r),i.d(r,{default:function(){return l}});var t=function(){var e=this,r=e.$createElement,i=e._self._c||r;return i("div",[i("van-sticky",{attrs:{"offset-top":1e-8}},[i("van-nav-bar",{attrs:{title:"临时访客登记","left-arrow":"","right-text":e.params.disabled?"":"保存"},on:{"click-left":e.onClickLeft,"click-right":function(r){return e.$refs.visitorInfo.submit()}}})],1),i("div",{staticClass:"edit-form"},[i("div",{staticClass:"tag-title"},[e._v("拜访信息")]),i("van-form",{ref:"visitorInfo",attrs:{"show-error":!1,model:e.visitorInfo,readonly:e.params.disabled},on:{submit:e.handleSubmit}},[i("div",{staticClass:"visitor-info"},[i("van-field",{attrs:{name:"visitorReason",required:"",label:"拜访事由",maxlength:"50",placeholder:"请输入拜访事由",rules:[{required:!0,message:"请输入拜访事由"}]},model:{value:e.visitorInfo.visitorReason,callback:function(r){e.$set(e.visitorInfo,"visitorReason",r)},expression:"visitorInfo.visitorReason"}}),i("van-field",{attrs:{required:"",readonly:"",name:"visitStartTime",disabled:!e.params.disabled,label:"拜访开始",placeholder:"请选择开始时间",rules:[{required:!0,message:"请选择开始时间"}]},model:{value:e.visitorInfo.visitStartTime,callback:function(r){e.$set(e.visitorInfo,"visitStartTime",r)},expression:"visitorInfo.visitStartTime"}}),i("van-field",{attrs:{clickable:!e.params.disabled,required:"",readonly:"",name:"visitEndTime",label:"拜访结束",placeholder:"请选择结束时间",rules:[{required:!0,message:"请选择结束时间"}]},on:{click:function(r){e.params.disabled||(e.showPickerEnd=!0)}},model:{value:e.visitorInfo.visitEndTime,callback:function(r){e.$set(e.visitorInfo,"visitEndTime",r)},expression:"visitorInfo.visitEndTime"}}),i("van-popup",{attrs:{position:"bottom"},model:{value:e.showPickerEnd,callback:function(r){e.showPickerEnd=r},expression:"showPickerEnd"}},[i("van-datetime-picker",{attrs:{type:"datetime","min-date":e.disabledTime("endMin"),"max-date":e.disabledTime("endMax")},on:{confirm:e.onConfirmEnd,cancel:function(r){e.showPickerEnd=!1}}})],1),i("van-field",{attrs:{name:"name",required:"",label:"被拜访者",maxlength:"10",placeholder:"请填写被拜访者",rules:[{required:!0,message:"请填写被拜访者"}]},model:{value:e.visitorInfo.name,callback:function(r){e.$set(e.visitorInfo,"name",r)},expression:"visitorInfo.name"}}),i("van-field",{attrs:{name:"phoneNbr",required:"",type:"digit",label:"被访者手机",maxlength:"11",placeholder:"请填写被访者手机",rules:[{required:!0,message:"请填写被访者手机"},{pattern:/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/,message:"请输入正确格式的手机号码"}]},model:{value:e.visitorInfo.phoneNbr,callback:function(r){e.$set(e.visitorInfo,"phoneNbr",r)},expression:"visitorInfo.phoneNbr"}})],1),i("div",{staticClass:"tag-title"},[e._v("详细信息")]),i("div",{staticClass:"visitor-info"},[i("van-field",{attrs:{name:"fileList",label:"人脸上传"},scopedSlots:e._u([{key:"input",fn:function(){return[i("van-uploader",{attrs:{readonly:e.params.disabled,deletable:!e.params.disabled,"before-read":e.beforeRead,accept:"image/jpeg,image/jpg,image/png","max-count":1},on:{delete:function(r){e.userInfo.picData=""}},model:{value:e.userInfo.fileList,callback:function(r){e.$set(e.userInfo,"fileList",r)},expression:"userInfo.fileList"}})]},proxy:!0}])}),i("van-field",{attrs:{placeholder:"请填写访客姓名",name:"visitorName",label:"访客姓名",required:"",maxlength:"8",rules:[{required:!0,message:"请填写访客姓名"}]},model:{value:e.userInfo.visitorName,callback:function(r){e.$set(e.userInfo,"visitorName",r)},expression:"userInfo.visitorName"}}),i("van-field",{attrs:{readonly:"",disabled:!e.params.disabled,name:"visitorPhoneNbr",label:"手机号码",required:"",placeholder:"请填写访客手机号码",type:"tel",maxlength:"11",rules:[{required:!0,message:"请填写访客手机号码"},{pattern:/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/,message:"请输入正确格式的手机号码"}]},model:{value:e.userInfo.visitorPhoneNbr,callback:function(r){e.$set(e.userInfo,"visitorPhoneNbr",r)},expression:"userInfo.visitorPhoneNbr"}}),i("van-field",{attrs:{clickable:!e.params.disabled,readonly:"",name:"voucherTypeName",label:"证件类型",placeholder:"请选择证件类型"},on:{click:function(r){e.params.disabled||(e.showPickerType=!0)}},model:{value:e.userInfo.voucherTypeName,callback:function(r){e.$set(e.userInfo,"voucherTypeName",r)},expression:"userInfo.voucherTypeName"}}),i("van-popup",{attrs:{position:"bottom"},model:{value:e.showPickerType,callback:function(r){e.showPickerType=r},expression:"showPickerType"}},[i("van-picker",{attrs:{title:"证件类型","show-toolbar":"",columns:e.showPickerTypeList.map((function(e){return e.dicDisplay}))},on:{cancel:function(r){e.showPickerType=!1},confirm:e.onConfirmType}})],1),i("van-field",{attrs:{readonly:"身份证"===e.userInfo.voucherTypeName||e.params.disabled,clickable:!e.params.disabled,name:"voucherCode",label:"证件号码",maxlength:"50",placeholder:"请填写访客证件号码"},on:{click:function(r){e.params.disabled||"身份证"!==e.userInfo.voucherTypeName||(e.numberShow=!0)}},model:{value:e.userInfo.voucherCode,callback:function(r){e.$set(e.userInfo,"voucherCode",r)},expression:"userInfo.voucherCode"}}),i("van-number-keyboard",{attrs:{show:e.numberShow,"extra-key":"X","close-button-text":"完成"},on:{blur:function(r){e.numberShow=!1},input:function(r){e.userInfo.voucherCode=e.userInfo.voucherCode+r},delete:function(r){e.userInfo.voucherCode=e.userInfo.voucherCode.substr(0,e.userInfo.voucherCode.length-1)}}}),i("van-field",{attrs:{name:"visitSex",label:"访客性别"},scopedSlots:e._u([{key:"input",fn:function(){return[i("van-radio-group",{attrs:{disabled:e.params.disabled,direction:"horizontal"},model:{value:e.userInfo.visitSex,callback:function(r){e.$set(e.userInfo,"visitSex",r)},expression:"userInfo.visitSex"}},e._l(e.visitSexList,(function(r){return i("van-radio",{key:r.dicValue,attrs:{name:r.dicValue}},[e._v(e._s(r.dicDisplay))])})),1)]},proxy:!0}])}),i("van-field",{attrs:{name:"plate",label:"车牌号码",maxlength:"8",placeholder:"请填写访客车牌号码"},model:{value:e.userInfo.plate,callback:function(r){e.$set(e.userInfo,"plate",r)},expression:"userInfo.plate"}}),i("van-field",{attrs:{name:"carryArticle",label:"携带物品",maxlength:"100",placeholder:"请填写访客携带物品"},model:{value:e.userInfo.carryArticle,callback:function(r){e.$set(e.userInfo,"carryArticle",r)},expression:"userInfo.carryArticle"}}),i("van-field",{attrs:{name:"remark",label:"备注",rows:"2",autosize:"",type:"textarea","show-word-limit":"",maxlength:"100",placeholder:"请填写备注"},model:{value:e.userInfo.remark,callback:function(r){e.$set(e.userInfo,"remark",r)},expression:"userInfo.remark"}})],1)])],1)],1)},_=[],s=i(6778),a=s.Z,o=i(1001),n=(0,o.Z)(a,t,_,!1,null,"0a4b0aa3",null),l=n.exports},9826:function(e,r,i){var t=i(2109),_=i(2092).find,s=i(1223),a="find",o=!0;a in[]&&Array(1)[a]((function(){o=!1})),t({target:"Array",proto:!0,forced:o},{find:function(e){return _(this,e,arguments.length>1?arguments[1]:void 0)}}),s(a)},6778:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var D_dataBank_Project_web_wisdomPark_source_html_visitorApp_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3019),D_dataBank_Project_web_wisdomPark_source_html_visitorApp_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6198),regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5666),regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4916),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(5306),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es_array_find_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(9826),core_js_modules_es_array_find_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es_array_find_js__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(1539),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(8309),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_7__),_api_visitor__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(3581),vuex__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(629);__webpack_exports__["Z"]={name:"TemporaryVisitorReg",data:function(){return{numberShow:!1,showPickerTypeList:[{dicDisplay:"身份证",dicValue:"1"},{dicDisplay:"香港身份证",dicValue:"2"},{dicDisplay:"澳门身份证",dicValue:"3"},{dicDisplay:"港澳通行证",dicValue:"4"},{dicDisplay:"台湾居民定居证",dicValue:"5"},{dicDisplay:"其他",dicValue:"6"}],visitSexList:[{dicDisplay:"男",dicValue:"0"},{dicDisplay:"女",dicValue:"1"}],showPickerType:!1,showPickerEnd:!1,visitorInfo:{},userInfo:{fileList:[],name:"",visitorPhoneNbr:"",voucherTypeName:"身份证",voucherCode:"",visitSex:"",carryArticle:"",remark:""},params:{}}},methods:{init:function init(){var _this=this;return(0,D_dataBank_Project_web_wisdomPark_source_html_visitorApp_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.Z)(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:scrollTo(0,0),_this.params=_this.$util.getRouteParams(_this.$route),_this.userInfo.visitorPhoneNbr=_this.params.visitorPhoneNbr,_this.params.temporaryVisitId&&!_this.params.phoneNbrError?(0,_api_visitor__WEBPACK_IMPORTED_MODULE_8__.W1)({visitorInfoId:_this.params.temporaryVisitId,visitorPhoneNbr:_this.params.visitorPhoneNbr,visitorOpenid:_this.params.openId}).then((function(res){if(200===res.code){var data=res.data.row[0];_this.visitorInfo=(0,D_dataBank_Project_web_wisdomPark_source_html_visitorApp_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_0__.Z)((0,D_dataBank_Project_web_wisdomPark_source_html_visitorApp_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_0__.Z)({},data),{},{visitStartTime:_this.$util.format(new Date(data.visitStartTime.replace(/-/g,"/")),"yyyy-MM-dd hh:mm"),visitEndTime:_this.$util.format(new Date(data.visitEndTime.replace(/-/g,"/")),"yyyy-MM-dd hh:mm")});var visitorPersonArr=eval("("+data.visitorPersonArr+")")[0];_this.userInfo=(0,D_dataBank_Project_web_wisdomPark_source_html_visitorApp_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_0__.Z)((0,D_dataBank_Project_web_wisdomPark_source_html_visitorApp_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_0__.Z)({},visitorPersonArr),{},{fileList:visitorPersonArr.picData?[{content:visitorPersonArr.picData.replace(/ /g,"+")}]:[],voucherTypeName:String(_this.showPickerTypeList.find((function(e){return visitorPersonArr.voucherType==e.dicValue})).dicDisplay)})}else _this.$toast.fail({message:res.msg})})):_this.setTime();case 4:case"end":return _context.stop()}}),_callee)})))()},setTime:function(){var e=new Date;this.visitorInfo.visitStartTime=this.$util.format(e,"yyyy-MM-dd hh:mm"),this.visitorInfo.visitEndTime=this.$util.format(new Date(e.setHours(e.getHours()+2)),"yyyy-MM-dd hh:mm")},onClickLeft:function(){this.$router.back(-1)},onConfirmEnd:function(e){this.visitorInfo.visitEndTime=this.$util.format(e,"yyyy-MM-dd hh:mm"),this.showPickerEnd=!1},disabledTime:function(e){switch(e){case"endMin":return this.visitorInfo.visitStartTime&&new Date(this.visitorInfo.visitStartTime.replace(/-/g,"/"));case"endMax":return this.visitorInfo.visitStartTime?new Date(Date.parse(this.visitorInfo.visitStartTime.replace(/-/g,"/"))+864e5):void 0}},beforeRead:function(e){var r=this;return(0,D_dataBank_Project_web_wisdomPark_source_html_visitorApp_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.Z)(regeneratorRuntime.mark((function i(){var t,_;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(t="image/jpeg"===e.type||"image/png"===e.type||"mage/jpg"===e.type,!t){i.next=8;break}return i.next=4,r.$util.iosRotateImg(e);case 4:_=i.sent,0==r.$util.isImgChekSize?r.userInfo.picData=_:1==r.$util.isImgChekSize?r.$toast.fail("您选择的相片小于25K，请重新选择相片！"):r.$toast.fail("您选择的相片超过了7500K，请重新选择相片！"),i.next=9;break;case 8:return i.abrupt("return",new Promise((function(e){return r.$toast({message:"请选择 jpg, png 格式文件!"}),r.userInfo.picData="",e(new Error(!1))})));case 9:case"end":return i.stop()}}),i)})))()},onConfirmType:function(e){this.userInfo.voucherTypeName=e,this.userInfo.voucherCode="",this.showPickerType=!1},handleSubmit:function(){var e=this;this.$toast.loading({duration:0,forbidClick:!0,message:"数据保存中..."});var r=null;r=this.params.temporaryVisitId?_api_visitor__WEBPACK_IMPORTED_MODULE_8__.dW:_api_visitor__WEBPACK_IMPORTED_MODULE_8__.Ab;var i=(0,D_dataBank_Project_web_wisdomPark_source_html_visitorApp_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_0__.Z)((0,D_dataBank_Project_web_wisdomPark_source_html_visitorApp_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_0__.Z)({},this.visitorInfo),{},{visitStartTime:this.visitorInfo.visitStartTime+":00",visitEndTime:this.visitorInfo.visitEndTime+":00",visitorInfoId:this.params.temporaryVisitId,unitId:this.unitId,visitorPhone:this.userInfo.visitorPhoneNbr,visitType:"3",visitorPersonArr:[(0,D_dataBank_Project_web_wisdomPark_source_html_visitorApp_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_0__.Z)((0,D_dataBank_Project_web_wisdomPark_source_html_visitorApp_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_0__.Z)({},this.userInfo),{},{fileList:null,voucherType:String(this.showPickerTypeList.find((function(r){return e.userInfo.voucherTypeName===r.dicDisplay})).dicValue)})]});if(this.params.isToOpenId)i.toOpenid=this.myUserInfo.openId;else{var t=this.params.openId;i.visitorOpenid=t,i.visitorPersonArr[0].visitorOpenid=t}r(i).then((function(r){e.$toast.clear(),200===r.code?(e.token=r.data.token,e.params.temporaryVisitId=r.data.id,e.$util.getRouteParams({name:e.$route.name,params:{temporaryVisitId:r.data.id,token:r.data.token}}),e.$toast.success({duration:200,message:r.msg}),e.params.openId||e.myUserInfo.openId||e.$router.push({name:"passCertificateTemporary"})):e.$toast.fail({message:r.msg})})).catch((function(){e.$toast.clear()}))}},computed:(0,D_dataBank_Project_web_wisdomPark_source_html_visitorApp_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_0__.Z)({},(0,vuex__WEBPACK_IMPORTED_MODULE_9__.rn)({myUserInfo:function(e){return e.user.userInfo},unitId:function(e){return e.user.unitId}})),created:function(){this.init()},beforeRouteLeave:function(e,r,i){"passCertificateTemporary"!==e.name&&this.$ls.remove(r.name),i()}}}}]);
//# sourceMappingURL=340-legacy.d5ddc9c6.js.map