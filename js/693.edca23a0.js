"use strict";(self["webpackChunkwisdom_park_pe"]=self["webpackChunkwisdom_park_pe"]||[]).push([[693],{6364:function(e,t,a){a.d(t,{Z:function(){return l}});var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("van-field",{attrs:{name:"code",label:"验证码",placeholder:"请输入验证码",maxlength:"8",rules:[{required:!0,message:"请输入验证码"}]},on:{input:function(t){return e.$emit("update:value",e.securityCode)}},scopedSlots:e._u([{key:"button",fn:function(){return[a("van-image",{staticClass:"digital-captcha",attrs:{fit:"fill",src:e.imgUrl},on:{click:e.init}})]},proxy:!0}]),model:{value:e.securityCode,callback:function(t){e.securityCode=t},expression:"securityCode"}})},i=[],r=a(9106),n={name:"SecurityCode",data(){return{imgUrl:"",securityCode:""}},props:{value:{type:String,default:""},biyiCaptchaKey:{type:String,default:""}},methods:{init(){this.getSecurityCode()},getSecurityCode(){this.securityCode="",(0,r.dM)().then((e=>{if(e){let t=Object.keys(e.data)[0];this.imgUrl=e.data[t],this.$emit("update:biyiCaptchaKey",Object.keys(e.data)[0])}})).catch()}},created(){this.init()}},o=n,u=a(1001),c=(0,u.Z)(o,s,i,!1,null,"2e4a3cd5",null),l=c.exports},4693:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login"},[s("img",{attrs:{width:"100%",fit:"fill",src:a(9722),alt:"图片加载失败"}}),s("van-form",{attrs:{"show-error":!1},on:{submit:e.onSubmit}},[s("van-cell-group",{attrs:{inset:""}},[s("van-field",{attrs:{name:"username",label:"用户名",placeholder:"请输入用户名",maxlength:"30",rules:[{required:!0,message:"请填写用户名"}]},model:{value:e.formItem.username,callback:function(t){e.$set(e.formItem,"username",t)},expression:"formItem.username"}}),s("van-field",{attrs:{type:"password",name:"password",label:"密码",maxlength:"30",placeholder:"请输入密码",rules:[{required:!0,message:"请填写密码"}]},model:{value:e.formItem.password,callback:function(t){e.$set(e.formItem,"password",t)},expression:"formItem.password"}}),s("SecurityCode",{ref:"securityCode",attrs:{value:e.value,biyiCaptchaKey:e.biyiCaptchaKey,width:"100%"},on:{"update:value":function(t){e.value=t},"update:biyiCaptchaKey":function(t){e.biyiCaptchaKey=t},"update:biyi-captcha-key":function(t){e.biyiCaptchaKey=t}}})],1),s("div",{staticClass:"btn-margin"},[s("van-button",{attrs:{round:"",block:"",loading:e.loading,type:"info","loading-text":"登录中...","native-type":"submit"}},[e._v(" 提交 ")])],1)],1)],1)},i=[],r=a(9106),n=a(7810),o=a(6364),u={name:"Login",data(){return{formItem:{username:"",password:""},code:"",loading:!1,value:"",biyiCaptchaKey:""}},methods:{onSubmit(){this.loading=!0,(0,r.x4)({rememberme:"0",username:this.formItem.username,password:this.formItem.password},{biyiCaptchaKey:this.biyiCaptchaKey,biyiCaptcha:JSON.stringify({code:this.value})}).then((e=>{this.loading=!1,200==e.status&&(e.data.passwordStatus?(this.$notify({type:"warning",message:1===e.data.passwordStatus?"您的密码为初始密码，请修改后再重新登录！":"密码已使用3个月，请修改后再重新登录！",duration:5e3}),this.$router.push({name:"updatePswd"})):(this.$ls.set(n.L,e.data.token,432e5),this.$ls.set("access_token",e.headers["access-token"],432e5),this.$notify({type:"primary",message:"登录成功",duration:1e3}),this.$router.push({name:"home"})))})).catch((e=>{if(this.loading=!1,this.code="",this.$refs.securityCode.init(),e.response)switch(e.response.status){case 401:if(e.response.data.attempts)this.$notify({message:`登录失败，您还有 ${e.response.data.attempts} 尝试机会！`});else{const t=this.formatLockedTime(e.response.data.lockoutTime);this.$notify({message:`登录失败，您的账号已被锁定，请在${t}后重试！`})}break;default:this.$notify({message:`登录失败，${e.response.data.message}！`});break}}))},formatLockedTime(e){let t="";const a=parseInt(e/86400);let s=parseInt(e%86400/3600),i=parseInt(e%3600/60),r=e%3600%60;return a>0&&(t=`${t}${a}天`),s>0&&(t=`${t}${s}小时`),i>0&&(t=`${t}${i}分`),r>0&&(t=`${t}${r}秒`),t}},components:{SecurityCode:o.Z}},c=u,l=a(1001),d=(0,l.Z)(c,s,i,!1,null,"5eb56014",null),m=d.exports},9722:function(e,t,a){e.exports=a.p+"img/login-bg.4f6f605b.png"}}]);
//# sourceMappingURL=693.edca23a0.js.map