"use strict";(self["webpackChunkwisdom_park_visitor"]=self["webpackChunkwisdom_park_visitor"]||[]).push([[74],{7074:function(e,t,i){i.r(t),i.d(t,{default:function(){return l}});var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"visitor-approval"},[s("van-sticky",{attrs:{"offset-top":1e-8}},[s("van-nav-bar",{attrs:{title:"访客审批","left-arrow":""},on:{"click-left":e.onClickLeft}})],1),s("van-pull-refresh",{on:{refresh:e.onRefresh},model:{value:e.refreshing,callback:function(t){e.refreshing=t},expression:"refreshing"}},[0==this.data.length?s("van-empty",{staticStyle:{height:"80vh"},attrs:{description:"没有需要审批的数据"}}):s("van-list",{staticStyle:{"min-height":"calc(100vh - 46px)"},attrs:{finished:e.finished,"finished-text":"没有更多了"},on:{load:e.onLoad},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},e._l(e.data,(function(t,a){return s("div",{key:a,staticClass:"custom-list",on:{click:function(t){return e.handleDetail(a)}}},[s("span",[e._v(e._s(t.addTime))]),s("van-swipe-cell",{scopedSlots:e._u([{key:"right",fn:function(){return[s("van-button",{attrs:{square:"",type:"primary",text:"同意"},on:{click:function(i){return e.handleApproval(t,"YYTY")}}}),s("van-button",{attrs:{square:"",type:"danger",text:"拒绝"},on:{click:function(i){return e.handleDecline(t,"YYBTY")}}})]},proxy:!0}],null,!0)},[s("van-cell",{attrs:{size:"large"},scopedSlots:e._u([{key:"title",fn:function(){return[s("div",{staticClass:"title"},[s("van-image",{attrs:{round:"",fit:"cover",src:t.picData||i(2752),alt:"图片加载失败"},on:{click:function(s){e.ImageView(t.picData||i(2752))}}}),s("span",[e._v(" "+e._s(t.visitorName)+" ")])],1)]},proxy:!0},{key:"label",fn:function(){return[s("div",{staticClass:"custom-title-detail"},[s("div",[s("span",[e._v("手机号码：")]),s("span",[e._v(e._s(t.visitorPhoneNbr))])]),s("div",[s("span",[e._v("访问时间：")]),s("span",[e._v(e._s(t.visitStartTime)+" - "+e._s(t.visitEndTime))])]),s("div",{class:{"show-detail":!0,"set-height":e.detailKeyList.includes(a)}},[s("van-divider",{style:{color:"#4b92d9",borderColor:"#5a9ee3",margin:"8px 0"},attrs:{dashed:"","content-position":"left"}},[e._v("详细信息")]),t.visitorReason?s("div",{staticClass:"van-ellipsis"},[s("span",[e._v("访问事由：")]),s("span",[e._v(e._s(t.visitorReason)+" ")])]):e._e(),t.voucherTypeName?s("div",[s("span",[e._v("证件类型：")]),s("span",[e._v(e._s(t.voucherTypeName))])]):e._e(),t.voucherCode?s("div",[s("span",[e._v("证件号码：")]),s("span",[e._v(e._s(t.voucherCode))])]):e._e(),t.visitSexName?s("div",[s("span",[e._v("访客性别：")]),s("span",[e._v(e._s(t.visitSexName))])]):e._e(),t.plate?s("div",[s("span",[e._v("车牌号码：")]),s("span",[e._v(e._s(t.plate))])]):e._e(),t.carryArticle?s("div",[s("span",[e._v("携带物品：")]),s("span",[e._v(e._s(t.carryArticle))])]):e._e(),t.remark?s("div",{staticClass:"van-ellipsis",on:{click:function(i){return i.stopPropagation(),e.$toast({duration:0,overlay:!0,closeOnClick:!0,message:t.remark,className:"toast-left",closeOnClickOverlay:!0})}}},[s("span",[e._v("备注：")]),s("span",[e._v(e._s(t.remark))])]):e._e()],1)])]},proxy:!0},{key:"default",fn:function(){return[s("span",{class:t.sts},[s("i"),e._v(" "+e._s(e.visitorStsList[t.sts])+" ")])]},proxy:!0}],null,!0)})],1)],1)})),0)],1)],1)},a=[],n=i(1125),r=n.Z,o=i(1001),_=(0,o.Z)(r,s,a,!1,null,null,null),l=_.exports},1125:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var vant_es_image_preview_style__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5684),vant_es_image_preview__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(993),_api_visitor__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3581),vuex__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(629);__webpack_exports__["Z"]={name:"visitorApproval",data(){return{data:[],loading:!1,finished:!1,refreshing:!1,page:{page:1,size:8},visitorStsList:{YYZ:"预约中",YYTY:"预约同意",YYBTY:"未同意"},detailKeyList:[]}},methods:{async init(){this.onRefresh()},ImageView(e){(0,vant_es_image_preview__WEBPACK_IMPORTED_MODULE_2__.Z)([e])},onClickLeft(){this.$router.back(-1)},handleDetail(e){const t=this.detailKeyList;t.includes(e)?this.detailKeyList=t.filter((t=>t!==e)):this.detailKeyList.push(e)},onLoad(){(0,_api_visitor__WEBPACK_IMPORTED_MODULE_1__.Hq)({visitType:"3",sts:"YYZ",phoneNbr:this.myUserInfo.phoneNbr,pageNo:this.page.page,pageSize:this.page.size}).then((res=>{this.loading=!1,200===res.code?(this.page.page+=1,this.refreshing&&(this.data=[],this.refreshing=!1),this.data=this.data.concat(res.data.row.map((item=>{const obj=eval("("+item.visitorPersonArr+")")[0];return obj.picData=obj.picData&&obj.picData.replace(/ /g,"+"),{...item,...obj,visitStartTime:this.$util.format(new Date(item.visitStartTime.replace(/-/g,"/")),"yyyy-MM-dd hh:mm"),visitEndTime:this.$util.format(new Date(item.visitEndTime.replace(/-/g,"/")),"yyyy-MM-dd hh:mm")}}))),this.data.length===res.data.total&&(this.finished=!0)):this.$toast.fail({message:res.msg})}))},onRefresh(){this.finished=!1,this.loading=!0,this.page.page=1,this.onLoad()},handleDecline(e,t){this.$dialog.confirm({title:`您确认拒绝${e.visitorName}访问吗？`}).then((()=>{this.handleApproval(e,t)})).catch((()=>{}))},handleApproval(e,t){this.$toast.loading({duration:0,message:"数据审批中..."}),(0,_api_visitor__WEBPACK_IMPORTED_MODULE_1__.Zg)({unitId:this.unitId,visitorInfoId:e.visitorInfoId,handleOpenid:this.myUserInfo.openId,phoneNbr:this.myUserInfo.phoneNbr,handleDt:new Date,handleRemark:this.visitorStsList[t],visitorSts:e.sts,sts:t}).then((i=>{this.$toast.clear(),200===i.code?(e.sts=t,e.visitorStsName=this.visitorStsList[t],this.$toast.success({message:i.msg})):this.$toast.fail({message:i.msg})}))}},created(){this.init()},computed:(0,vuex__WEBPACK_IMPORTED_MODULE_3__.rn)({myUserInfo:e=>e.user.userInfo,unitId:e=>e.user.unitId})}},5684:function(e,t,i){i(6434),i(6559),i(4199),i(3683),i(6226),i(3103),i(5802),i(4783),i(8409),i(6479)},2752:function(e,t,i){e.exports=i.p+"img/default-touxiang.0f5aba16.png"}}]);
//# sourceMappingURL=74.ba9ccb33.js.map